{"version":3,"file":"ModalToS.js","names":["React","useEffect","useState","convertKeyNames","getConfig","getAuthenticatedUser","FormattedMessage","getLocale","injectIntl","Button","Form","Hyperlink","ModalDialog","useToggle","useCheckboxSetValues","ActionRow","useWindowSize","getUserTOSPreference","updateUserTOSPreference","CAMEL_CASE_KEYS","parseEnvSettings","createTOSLink","chunks","url","createElement","destination","target","ModalToS","_useState","undefined","_useState2","_slicedToArray","tosPreference","setTosPreference","_useToggle","_useToggle2","isOpen","open","close","_useWindowSize","width","checkboxLabelStyle","_getConfig","MODAL_UPDATE_TERMS_OF_SERVICE","PRIVACY_POLICY_URL","SITE_NAME","TERMS_OF_SERVICE_URL","TOS_AND_HONOR_CODE","modalSettings","_convertKeyNames","_convertKeyNames$body","body","_convertKeyNames$titl","title","dateIso8601","_convertKeyNames$data","dataAuthorization","_convertKeyNames$hono","honorCode","_convertKeyNames$term","termsOfService","_getAuthenticatedUser","dateJoined","username","lang","tosKey","concat","replaceAll","_useCheckboxSetValues","_useCheckboxSetValues2","checkboxValues","_useCheckboxSetValues3","add","remove","then","userTos","setAcceptance","numCheckBox","reduce","prev","curr","handleChange","e","checked","value","console","debug","Date","isBlocking","onClose","hasCloseButton","Header","Title","Body","className","CheckboxSet","name","onChange","Checkbox","labelClassName","id","description","defaultMessage","values","a","platformName","isStacked","variant","disabled","length","onClick"],"sources":["../../../src/components/modal-tos/ModalToS.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { convertKeyNames, getConfig } from '@edx/frontend-platform';\nimport { getAuthenticatedUser } from '@edx/frontend-platform/auth';\nimport { FormattedMessage, getLocale, injectIntl } from '@edx/frontend-platform/i18n';\nimport {\n  Button, Form, Hyperlink, ModalDialog, useToggle, useCheckboxSetValues,\n  ActionRow,\n  useWindowSize,\n} from '@openedx/paragon';\n\nimport { getUserTOSPreference, updateUserTOSPreference } from './data/api';\nimport { CAMEL_CASE_KEYS } from './data/constants';\nimport parseEnvSettings from '../../utils/parseData';\n\nconst createTOSLink = (chunks, url) => (\n  <Hyperlink\n    destination={url}\n    target=\"_blank\"\n  >{chunks}\n  </Hyperlink>\n);\n\nconst ModalToS = () => {\n  const [tosPreference, setTosPreference] = useState(undefined);\n  const [isOpen, open, close] = useToggle(false);\n  const { width } = useWindowSize();\n  const checkboxLabelStyle = (width < 768) ? 'd-inline-block' : null;\n  const {\n    MODAL_UPDATE_TERMS_OF_SERVICE,\n    PRIVACY_POLICY_URL,\n    SITE_NAME,\n    TERMS_OF_SERVICE_URL,\n    TOS_AND_HONOR_CODE,\n  } = getConfig();\n\n  const modalSettings = parseEnvSettings(MODAL_UPDATE_TERMS_OF_SERVICE) || MODAL_UPDATE_TERMS_OF_SERVICE || {};\n  const {\n    body = {},\n    title = {},\n    dateIso8601,\n    dataAuthorization = false,\n    honorCode = false,\n    termsOfService = false,\n  } = convertKeyNames(modalSettings, CAMEL_CASE_KEYS);\n\n  const {\n    dateJoined,\n    username,\n  } = getAuthenticatedUser();\n\n  const lang = getLocale() || 'en';\n  const tosKey = `update_terms_of_service_${dateIso8601?.replaceAll('-', '_')}`;\n  const [checkboxValues, { add, remove }] = useCheckboxSetValues([]);\n\n  useEffect(() => {\n    if (username && dateIso8601) {\n      getUserTOSPreference(username, tosKey).then(userTos => {\n        setTosPreference(userTos);\n        if (userTos === null) {\n          open();\n        }\n      });\n    }\n  }, [dateIso8601, tosKey, username, open]);\n\n  const setAcceptance = () => {\n    updateUserTOSPreference(username, tosKey);\n    close();\n  };\n\n  const numCheckBox = [dataAuthorization, termsOfService, honorCode]\n    .reduce((prev, curr) => (curr ? prev + 1 : prev), 0);\n\n  const handleChange = e => {\n    if (e.target.checked) {\n      add(e.target.value);\n    } else {\n      remove(e.target.value);\n    }\n  };\n  console.debug( new Date(dateIso8601), 'dateJoined', dateJoined, new Date(dateIso8601) < new Date(dateJoined));\n\n  if (tosPreference || !dateIso8601 || !username || !dateJoined\n    || new Date(dateIso8601) <= new Date(dateJoined)) {\n    return null;\n  }\n\n  return (\n    <ModalDialog\n      title=\"Modal Terms of Service\"\n      isBlocking\n      isOpen={isOpen}\n      onClose={close}\n      hasCloseButton={false}\n    >\n      {title[lang] && (\n      <ModalDialog.Header>\n        <ModalDialog.Title>\n          {title[lang]}\n        </ModalDialog.Title>\n      </ModalDialog.Header>\n      )}\n      <ModalDialog.Body>\n        {body[lang]}\n        <Form className=\"my-4\">\n          <Form.CheckboxSet\n            name=\"TOSCheckbox\"\n            onChange={handleChange}\n            value={checkboxValues}\n          >\n            {dataAuthorization\n              && (\n                <Form.Checkbox value=\"dataAuthorization\" labelClassName={checkboxLabelStyle}>\n                  <FormattedMessage\n                    id=\"modalToS.dataAuthorization.checkbox.label\"\n                    description=\"The label for the data authorization checkbox inside the TOS modal.\"\n                    defaultMessage=\"I have read and understood the&nbsp;<a>Privacy Policy</a>\"\n                    values={{\n                      a: chunks => createTOSLink(chunks, PRIVACY_POLICY_URL),\n                    }}\n                  />\n                </Form.Checkbox>\n              )}\n            {termsOfService\n              && (\n                <Form.Checkbox value=\"termsOfService\" labelClassName={checkboxLabelStyle}>\n                  <FormattedMessage\n                    id=\"modalToS.termsOfService.checkbox.label\"\n                    description=\"The label for the terms of service checkbox inside the TOS modal.\"\n                    defaultMessage=\"I agree to the {platformName}&nbsp;<a>Terms of Service</a>\"\n                    values={{\n                      a: chunks => createTOSLink(chunks, TERMS_OF_SERVICE_URL),\n                      platformName: SITE_NAME,\n                    }}\n                  />\n                </Form.Checkbox>\n              )}\n            {honorCode\n              && (\n                <Form.Checkbox value=\"honorCode\" labelClassName={checkboxLabelStyle}>\n                  <FormattedMessage\n                    id=\"modalToS.honorCode.checkbox.label\"\n                    description=\"The label for the honor code checkbox inside the TOS modal.\"\n                    defaultMessage=\"I agree to the {platformName}&nbsp;<a>Honor Code</a>\"\n                    values={{\n                      a: chunks => createTOSLink(chunks, TOS_AND_HONOR_CODE),\n                      platformName: SITE_NAME,\n                    }}\n                  />\n                </Form.Checkbox>\n              )}\n          </Form.CheckboxSet>\n        </Form>\n        <ActionRow isStacked>\n          <Button\n            variant=\"primary\"\n            disabled={numCheckBox !== checkboxValues.length}\n            onClick={setAcceptance}\n            data-testid=\"modalToSButton\"\n          >\n            <FormattedMessage\n              id=\"modalToS.acceptance.button\"\n              description=\"The label for the button inside the TOS modal.\"\n              defaultMessage=\"Accept new terms of service\"\n            />\n          </Button>\n        </ActionRow>\n      </ModalDialog.Body>\n    </ModalDialog>\n  );\n};\n\nexport default injectIntl(ModalToS);\n"],"mappings":"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","ignoreList":[]}